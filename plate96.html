<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <title>Platemap - 96 well</title>

  <style>
    #selectable .ui-selecting {
      background: #FECA40;
      font-weight: bold;
    }

    #selectable .ui-selected {
      background: #F39814;
      color: white;
      font-weight: bold;
    }

    #selectable {
      list-style-type: none;
      margin: 0;
      padding: 0;
      width: 480px;
    }

    #selectable li {
      margin: 3px;
      padding: 1px;
      float: left;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      line-height: 30px;
      font-size: 0.8em;
      font-family: monospace;
      text-align: center;
      background: #DADADA;
    }
  </style>

  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script src="functions.js"></script>
  <script>
    $(function () {
      $("#selectable").selectable();
    })

    function setWellColour(id, colour) {
      $("#" + id).css("background", colour)
      $("#" + id).css("color", decideTextColour(colour))
    }

    function setWellAnnotation(id, value) {
      $("#" + id).attr("annotation", value)
    }

    function setWellTitle(id, value) {
      $("#" + id).attr("title", value)
    }

  </script>
</head>

<body>
  <a href="index.html">
    <h1>PlateMapper</h1>
  </a>
  <h3>Instructions</h3>
  <ol>
    <li>Drag or click to select wells to label. Hold Ctrl to select additional wells.</li>
    <li>Assign selected wells a label and colour, click "Add annotation"</li>
    <li>Export annotations as a csv</li>
  </ol>
  <br>
  <hr>
  <br>

  <label for="annotation">Label</label>
  <input id="annotation" type="text" name="annotation">
  <label for="colour">Colour</label>
  <input id="colour" type="color" name="colour" value="#EEDA00">
  <button id="btn-add">Add annotation</button>
  <button id="btn-export">Export as csv</button>
  <br>
  <br>

  <div>
    <ol id="selectable">
      <li id="A01" class="ui-state-default" annotation="">A01</li>
      <li id="A02" class="ui-state-default" annotation="">A02</li>
      <li id="A03" class="ui-state-default" annotation="">A03</li>
      <li id="A04" class="ui-state-default" annotation="">A04</li>
      <li id="A05" class="ui-state-default" annotation="">A05</li>
      <li id="A06" class="ui-state-default" annotation="">A06</li>
      <li id="A07" class="ui-state-default" annotation="">A07</li>
      <li id="A08" class="ui-state-default" annotation="">A08</li>
      <li id="A09" class="ui-state-default" annotation="">A09</li>
      <li id="A10" class="ui-state-default" annotation="">A10</li>
      <li id="A11" class="ui-state-default" annotation="">A11</li>
      <li id="A12" class="ui-state-default" annotation="">A12</li>

      <li id="B01" class="ui-state-default" annotation="">B01</li>
      <li id="B02" class="ui-state-default" annotation="">B02</li>
      <li id="B03" class="ui-state-default" annotation="">B03</li>
      <li id="B04" class="ui-state-default" annotation="">B04</li>
      <li id="B05" class="ui-state-default" annotation="">B05</li>
      <li id="B06" class="ui-state-default" annotation="">B06</li>
      <li id="B07" class="ui-state-default" annotation="">B07</li>
      <li id="B08" class="ui-state-default" annotation="">B08</li>
      <li id="B09" class="ui-state-default" annotation="">B09</li>
      <li id="B10" class="ui-state-default" annotation="">B10</li>
      <li id="B11" class="ui-state-default" annotation="">B11</li>
      <li id="B12" class="ui-state-default" annotation="">B12</li>

      <li id="C01" class="ui-state-default" annotation="">C01</li>
      <li id="C02" class="ui-state-default" annotation="">C02</li>
      <li id="C03" class="ui-state-default" annotation="">C03</li>
      <li id="C04" class="ui-state-default" annotation="">C04</li>
      <li id="C05" class="ui-state-default" annotation="">C05</li>
      <li id="C06" class="ui-state-default" annotation="">C06</li>
      <li id="C07" class="ui-state-default" annotation="">C07</li>
      <li id="C08" class="ui-state-default" annotation="">C08</li>
      <li id="C09" class="ui-state-default" annotation="">C09</li>
      <li id="C10" class="ui-state-default" annotation="">C10</li>
      <li id="C11" class="ui-state-default" annotation="">C11</li>
      <li id="C12" class="ui-state-default" annotation="">C12</li>

      <li id="D01" class="ui-state-default" annotation="">D01</li>
      <li id="D02" class="ui-state-default" annotation="">D02</li>
      <li id="D03" class="ui-state-default" annotation="">D03</li>
      <li id="D04" class="ui-state-default" annotation="">D04</li>
      <li id="D05" class="ui-state-default" annotation="">D05</li>
      <li id="D06" class="ui-state-default" annotation="">D06</li>
      <li id="D07" class="ui-state-default" annotation="">D07</li>
      <li id="D08" class="ui-state-default" annotation="">D08</li>
      <li id="D09" class="ui-state-default" annotation="">D09</li>
      <li id="D10" class="ui-state-default" annotation="">D10</li>
      <li id="D11" class="ui-state-default" annotation="">D11</li>
      <li id="D12" class="ui-state-default" annotation="">D12</li>

      <li id="E01" class="ui-state-default" annotation="">E01</li>
      <li id="E02" class="ui-state-default" annotation="">E02</li>
      <li id="E03" class="ui-state-default" annotation="">E03</li>
      <li id="E04" class="ui-state-default" annotation="">E04</li>
      <li id="E05" class="ui-state-default" annotation="">E05</li>
      <li id="E06" class="ui-state-default" annotation="">E06</li>
      <li id="E07" class="ui-state-default" annotation="">E07</li>
      <li id="E08" class="ui-state-default" annotation="">E08</li>
      <li id="E09" class="ui-state-default" annotation="">E09</li>
      <li id="E10" class="ui-state-default" annotation="">E10</li>
      <li id="E11" class="ui-state-default" annotation="">E11</li>
      <li id="E12" class="ui-state-default" annotation="">E12</li>

      <li id="F01" class="ui-state-default" annotation="">F01</li>
      <li id="F02" class="ui-state-default" annotation="">F02</li>
      <li id="F03" class="ui-state-default" annotation="">F03</li>
      <li id="F04" class="ui-state-default" annotation="">F04</li>
      <li id="F05" class="ui-state-default" annotation="">F05</li>
      <li id="F06" class="ui-state-default" annotation="">F06</li>
      <li id="F07" class="ui-state-default" annotation="">F07</li>
      <li id="F08" class="ui-state-default" annotation="">F08</li>
      <li id="F09" class="ui-state-default" annotation="">F09</li>
      <li id="F10" class="ui-state-default" annotation="">F10</li>
      <li id="F11" class="ui-state-default" annotation="">F11</li>
      <li id="F12" class="ui-state-default" annotation="">F12</li>

      <li id="G01" class="ui-state-default" annotation="">G01</li>
      <li id="G02" class="ui-state-default" annotation="">G02</li>
      <li id="G03" class="ui-state-default" annotation="">G03</li>
      <li id="G04" class="ui-state-default" annotation="">G04</li>
      <li id="G05" class="ui-state-default" annotation="">G05</li>
      <li id="G06" class="ui-state-default" annotation="">G06</li>
      <li id="G07" class="ui-state-default" annotation="">G07</li>
      <li id="G08" class="ui-state-default" annotation="">G08</li>
      <li id="G09" class="ui-state-default" annotation="">G09</li>
      <li id="G10" class="ui-state-default" annotation="">G10</li>
      <li id="G11" class="ui-state-default" annotation="">G11</li>
      <li id="G12" class="ui-state-default" annotation="">G12</li>

      <li id="H01" class="ui-state-default" annotation="">H01</li>
      <li id="H02" class="ui-state-default" annotation="">H02</li>
      <li id="H03" class="ui-state-default" annotation="">H03</li>
      <li id="H04" class="ui-state-default" annotation="">H04</li>
      <li id="H05" class="ui-state-default" annotation="">H05</li>
      <li id="H06" class="ui-state-default" annotation="">H06</li>
      <li id="H07" class="ui-state-default" annotation="">H07</li>
      <li id="H08" class="ui-state-default" annotation="">H08</li>
      <li id="H09" class="ui-state-default" annotation="">H09</li>
      <li id="H10" class="ui-state-default" annotation="">H10</li>
      <li id="H11" class="ui-state-default" annotation="">H11</li>
      <li id="H12" class="ui-state-default" annotation="">H12</li>
    </ol>

  </div>
</body>

<script>
  $("#btn-add").click(function () {
    var annotation = $("[name='annotation']").val()
    var colour = $("[name='colour']").val()
    $(".ui-selected").each(function () {
      setWellColour(this.id, colour)
      setWellAnnotation(this.id, annotation)
      setWellTitle(this.id, `${this.id}: ${annotation}`)
    })
  })

  $("#btn-export").click(function () {
    var csv = "well,annotation\n"
    // loop though wells, get well-id and annotation
    $("#selectable li").each(function () {
      well = this.id
      annotation = $(this).attr("annotation")
      csv += `${well},${annotation}\n`
    })
    saveAs(csv, "platemap.csv")
  })
</script>

</html>
